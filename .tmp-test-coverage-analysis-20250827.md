# Test Coverage Analysis - AUTH-4 Branch

## Current Status
- Overall coverage: 69.42% (target: 80%+)
- JWT validator tests: ✅ FIXED (all 4 failing tests now pass)
- Pytest marker issue: ✅ FIXED (added 'api' marker to pyproject.toml)

## Critical 0% Coverage Files Requiring Immediate Tests

### API Layer (0% coverage)
1. **src/api/auth_endpoints.py** - 162 lines, 0% coverage
2. **src/auth/audit_service.py** - 179 lines, 0% coverage

### Services Layer (0% coverage)  
3. **src/auth/services/fastapi_integration.py** - 158 lines, 0% coverage
4. **src/auth/services/health_assessor.py** - 260 lines, 0% coverage
5. **src/auth/services/metrics_calculator.py** - 95 lines, 0% coverage
6. **src/auth/services/mock_data_service.py** - 152 lines, 0% coverage
7. **src/auth/services/risk_analyzer.py** - 271 lines, 0% coverage

### Core Components (0% coverage)
8. **src/auth/suspicious_activity_detector.py** - 148 lines, 0% coverage

## High-Impact Low Coverage Files (20-79% range)

### Database Layer
- **src/auth/database/security_events_postgres.py**: 14.47% (210 lines)
- **src/database/connection.py**: 82.93% (needs 3% boost)

### Services with Medium Coverage (60-79%)
- **src/auth/services/alert_engine.py**: 63.07% (505 lines)
- **src/auth/services/security_logger.py**: 61.80% (185 lines)
- **src/auth/services/suspicious_activity_detector.py**: 60.64% (1030 lines - LARGE!)
- **src/auth/services/security_monitor.py**: 74.49% (400 lines)

### UI and Integration
- **src/ui/multi_journey_interface.py**: 75.00% (604 lines)
- **src/mcp_integration/openrouter_client.py**: 77.75% (301 lines)

## Agent Assignment Strategy

### Priority 1: Zero Coverage Files (Agent: Test Engineer)
- Assign each 0% coverage file to test engineer agent
- Focus on achieving 80%+ coverage for critical AUTH-4 components

### Priority 2: Medium Coverage Boost (Agent: Test Engineer)
- Target files in 60-79% range for specific improvement
- Focus on untested error paths and edge cases

### Priority 3: Integration Issues (Agent: Debug Agent)  
- Resolve failing performance tests
- Fix cross-test interference issues mentioned by user

## Test Execution Issues Identified
1. Performance test failures (test_auth4_performance_requirements.py)
2. Cross-test interference affecting JWT validator tests when run together
3. Settings persistence issues between test runs

## Expected Impact
- Moving 8 files from 0% to 80% = ~1,400 lines of coverage gain
- Improving medium coverage files by 10-20% = ~500-800 lines
- Total expected coverage increase: 15-20 percentage points