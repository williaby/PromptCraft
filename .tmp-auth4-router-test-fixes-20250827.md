# AUTH-4 Router Test Fixes Analysis - August 27, 2025

## Issue Summary
API router tests were created with method calls that don't match the actual router implementations. The routers are calling non-existent methods on the service classes.

## Critical Method Misalignments Found

### 1. Alerts Router (src/auth/api/routers/alerts_router.py)
**Router Code Issues:**
- Line 84: Calls `alert_engine.get_recent_alerts(limit=limit + offset)` - **METHOD DOES NOT EXIST**
- Line 150: Calls `alert_engine.get_alert_by_id(alert_id)` - **METHOD DOES NOT EXIST**  
- Line 158: Calls `alert_engine.acknowledge_alert(alert_id, user_id, notes)` - **METHOD DOES NOT EXIST**

**Test Code Issues:**
- Line 120: `mock_security_service.get_security_alerts.return_value = sample_alerts_list`
- Line 216: `mock_alert_engine.acknowledge_alert.return_value = True`

### 2. Analytics Router Analysis Needed
Need to check analytics_router.py for similar issues.

## Root Cause
The router implementations were created with method calls to services that don't have those methods implemented. This creates a fundamental disconnect between:
1. Router expectations
2. Service implementations  
3. Test mock expectations

## Fix Strategy

### Option 1: Fix Router Implementations (Preferred)
Update routers to call methods that actually exist in the service classes.

### Option 2: Implement Missing Methods
Add the missing methods to AlertEngine and other services.

### Option 3: Fix Tests Only
Update tests to match the (broken) router implementations.

**Recommendation: Option 1** - Fix the router implementations to call correct methods.

## Next Steps
1. Audit all 8 router files for method misalignments
2. Identify what methods actually exist in each service class
3. Fix router implementations to call correct methods  
4. Update tests to match corrected router implementations
5. Run coverage validation

## Files Requiring Analysis
- src/auth/api/routers/alerts_router.py âœ… (BROKEN - methods don't exist)
- src/auth/api/routers/analytics_router.py (TBD)
- src/auth/api/routers/audit_router.py (TBD)
- src/auth/api/routers/charts_router.py (TBD)
- src/auth/api/routers/events_router.py (TBD)
- src/auth/api/routers/health_router.py (TBD)
- src/auth/api/routers/metrics_router.py (TBD)
- src/auth/api/routers/users_router.py (TBD)